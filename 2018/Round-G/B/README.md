# [Combining Classes](https://code.google.com/codejam/contest/5374486/dashboard#s=p1)

## 题目描述  

有N个连续的有序序列，对于第i个序列而言（1 <= i <= N），其范围是[Li, Ri) (由Li开始每次递增1直到Ri，题目原意为闭区间，但我们可以把终点手动+1凑成左闭右开区间，这样解题更方便)
现在有Q个查询，对于第j个查询（1 <= j <= Q），希望求得所有N个序列合并在一起之后（就像归并排序那样），第Ki大的数是几

## 数据范围  

1 <= N <= 4 x 10^5  
1 <= Li, Ri <= 10^9  
1 <= Q <= 10^5  

## 解题步骤

官方题解里是用线段树做的，其实不必要，用差分即可

* 1.离散化  
* 2.差分  
* 3.二分搜索  

## 分析
Li和Ri之间的跨度很大（可能到10^9），但不同的Li和Ri的个数却最多只有2N种，
因此可以考虑先做一个离散化，这时候所有数字就都在区间 [1, 2N] 里面了。
设置一个数组g，其中g[x]为[x, x + 1)这个区间被覆盖了多少次，这个可以用差分求得
然后将g中的每一个元素乘以对应原始区间的长度，这是为了还原离散化的效果
然后求g的后缀和，这样我们就求得了对于从[1, 2N)中的每一个数x，大于等于它的数字有多少个，记为f(x)

若想查询第K大的数，我们先找到最大的一个x，使得f(x) >= K，这个可以用二分搜索完成
然后我们求一个step = f(x) - K，意为我们还需要从x往后走多少步才能刚好达到第K大的数
结合区间[x, x + 1)一共被覆盖了多少次，以及其对应的原始区间的长度，我们就能求得再走step步之后，应该落到哪个数上，那个数就是结果

## 复杂度
离散化：O(NlogN)  
差分：O(N)  
二分搜索：O(QlogN)  

总复杂度：O(NlogN) + O(N) + O(QlogN) = O((N + Q)logN)
